@model IEnumerable<PersianMemo.Models.Word>
@inject SignInManager<IdentityUser> signInManager
@inject LanguageService language

@{
    ViewData["Title"] = language.Getkey("homePage");
}

<input type="hidden" id="lang" value="@language.Getkey("lang")">
@if (signInManager.IsSignedIn(User))
{
    <div class="row">
    <div class="col-6">
        <h2 class="text-primary">@language.Getkey("wordsList")</h2>
    </div>
    </div>

    <div class="tbl-container">
        <div class="row">
            <div>
                <div class="p-4 border rounded">
                    <table id="tblWords" class="table table-striped table-bordered" style="width:100%">
                        <thead class="thead-dark">
                            <tr class="table-info">
                                <th>@language.Getkey("word")</th>
                                <th>@language.Getkey("translation")</th>
                                <th>@language.Getkey("difficulty")</th>
                                <th>@language.Getkey("pronunciation")</th>
                                <th>Status</th>
                                <th></th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
} else
{
    <header class="hero">
        <div class="content">
            <h1>@language.Getkey("content11") <span class="sand-colour">@language.Getkey("content12")</span> @language.Getkey("content13") <span class="sand-colour">@language.Getkey("content14")</span> </h1>
            <p>
                فارسی را با ما در کمترین زمان یاد بگیرید
            </p>
            <p class="sand-colour">@language.Getkey("content2")</p>
            <div class="btn-content-container">
                <a asp-controller="account" asp-action="register" class="btn btn-content">@language.Getkey("register")</a>
                <a asp-controller="account" asp-action="login" class="btn btn-content">@language.Getkey("login")</a>
            </div>
        </div>
    </header>
    
}

@section Scripts{
    <script>
        var dataTable;

        function playAudio(url) {
            new Audio(url).play();
        }

        $(document).ready(function () {
            var language = document.querySelector('#lang').value;
            var details,
                goToExercise;
            if (language === "PL") {
                details = "Szczegóły";
                goToExercise = "Przejdź do ćwiczenia zaznaczonych słówek";
            } else {
                details = "Details";
                goToExercise = "Practise selected words"

            }
            loadDataTable(details, goToExercise);
        });


        function loadDataTable(details, goToExercise) {
            dataTable = $('#tblWords').DataTable({
                dom: 'Bfrtip',
                buttons: [
                    {
                        text: `${goToExercise}`,
                        attr: {
                            id: 'button'
                        }
                    }
                ],
                "ajax": {
                    "url": "/Home/GetAll"
                },
                "columns": [
                    { "data": "persianWord", "autoWidth": "true" },
                    { "data": "translation", "autoWidth": "true" },
                    { "data": "difficulty", "autoWidth": "true" },
                    {
                        "data": "pronunciationPath",
                        "render": function (data) {


                            if (data != null) {
                                return `
                        <a onclick="playAudio('/audio/${data}')"><i class="fa-solid fa-play"></i></a>
                        `
                            } else {
                                return `
                        <a><i class="fa-solid fa-volume-slash"></i></a>
                        `
                            }
                        }, "autoWidth": "true"
                    },
                    {
                        "data": "status",
                        "render": function (data) {


                            if (data == 1) {
                                return `
                        <a>@language.Getkey("notStarted")</a>
                        `
                            } else if (data == 2) {
                                return `
                        <a>@language.Getkey("inProgress")</a>
                        `
                            } else {
                                return `
                        <a>@language.Getkey("completed")</a>
                        `
                            }
                        }, "autoWidth": "true"
                    },
                    {
                        "data": "id",
                        "render": function (data) {
                            return `
                    <a href="home/details/${data}" class="btn btn-primary m-1">${details}</a>
                    <a href="home/delete/${data}" class="btn btn-danger m-1"><i class="fa-solid fa-trash"></i></a>
                    `                }
                    }
                ]
            });

            $('#tblWords tbody').on('dblclick', 'tr', function () {
                $(this).toggleClass('selected');
            });

            $('#button').click(function () {
                var selectedData = dataTable.rows('.selected').data();
                var selectedIds = []

                for (var i = 0; i < selectedData.length; i++) {
                    selectedIds.push(selectedData[i].id);
                }

                console.log(selectedIds);

                $.ajax({
                    type: "POST",
                    url: "/Home/Index",
                    data: { ids: selectedIds },
                    dataType: "json",
                    traditional: "true",
                    success: function (res) {
                        window.location.href = `/Exercise/Details/${res.data}`;
                        console.log(data);
                    },
                })
            });
        }
    </script>
}
